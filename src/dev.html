<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tubes Cursor - Dev</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; background: linear-gradient(to right, #000 50%, #fff 50%) !important; }
    #canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: transparent !important; z-index: 1; }
    .lil-gui { z-index: 9999 !important; }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>

  <script>console.log('=== PAGE LOADED ===');</script>
  <script type="module">
    import TubesCursor from './tubes-cursor-clean.js';
    import GUI from 'lil-gui';

    console.log('=== DEV.HTML SCRIPT START ===');
    console.log('GUI:', GUI);

    // Initialize
    const app = TubesCursor(document.getElementById('canvas'), {
      bloom: {
        threshold: 0,
        strength: 0.3,
        radius: 0.2,
      },
      tubes: {
        lights: { intensity: 40 },
        lerp: 0.1
      }
    });
    window.app = app;

    // GUI
    const gui = new GUI({ title: 'Tubes Controls' });
    gui.domElement.style.zIndex = '9999';
    console.log('GUI created:', gui);

    // Lights
    const lightsFolder = gui.addFolder('Lights');
    const lightsParams = { intensity: 40 };
    lightsFolder.add(lightsParams, 'intensity', 0, 500, 1).onChange(v => {
      app.tubes.setLightsIntensity(v);
    });

    // Material
    const matFolder = gui.addFolder('Material');
    const matParams = {
      metalness: app.tubes.options.material.metalness,
      roughness: app.tubes.options.material.roughness
    };
    matFolder.add(matParams, 'metalness', 0, 1, 0.01).onChange(v => {
      app.tubes.tubes.forEach(t => t.material.metalness = v);
    });
    matFolder.add(matParams, 'roughness', 0, 1, 0.01).onChange(v => {
      app.tubes.tubes.forEach(t => t.material.roughness = v);
    });

    // Bloom
    if (app.bloom) {
      const bloomFolder = gui.addFolder('Bloom');
      const bloomParams = {
        threshold: 0,
        strength: 0.3,
        radius: 0.2
      };
      bloomFolder.add(bloomParams, 'threshold', 0, 1, 0.01).onChange(v => {
        app.bloom.setParams({ threshold: v });
      });
      bloomFolder.add(bloomParams, 'strength', 0, 3, 0.01).onChange(v => {
        app.bloom.setParams({ strength: v });
      });
      bloomFolder.add(bloomParams, 'radius', 0, 2, 0.01).onChange(v => {
        app.bloom.setParams({ radius: v });
      });
    }

    // Tubes geometry
    const tubesFolder = gui.addFolder('Tubes');
    const tubesParams = {
      minRadius: app.tubes.options.minRadius,
      maxRadius: app.tubes.options.maxRadius,
      minSegments: app.tubes.options.minTubularSegments,
      maxSegments: app.tubes.options.maxTubularSegments,
      count: app.tubes.options.count
    };
    tubesFolder.add(tubesParams, 'minRadius', 0.001, 0.1, 0.001).name('Min Radius');
    tubesFolder.add(tubesParams, 'maxRadius', 0.01, 0.2, 0.001).name('Max Radius');
    tubesFolder.add(tubesParams, 'minSegments', 8, 64, 1).name('Min Length');
    tubesFolder.add(tubesParams, 'maxSegments', 32, 256, 1).name('Max Length');
    tubesFolder.add(tubesParams, 'count', 4, 32, 1).name('Count');
    tubesFolder.add({ rebuild: () => {
      // Update options
      app.tubes.options.minRadius = tubesParams.minRadius;
      app.tubes.options.maxRadius = tubesParams.maxRadius;
      app.tubes.options.minTubularSegments = tubesParams.minSegments;
      app.tubes.options.maxTubularSegments = tubesParams.maxSegments;
      app.tubes.options.count = tubesParams.count;
      // Rebuild tubes
      app.tubes.dispose();
      app.tubes.init();
    }}, 'rebuild').name('ðŸ”„ Rebuild Tubes');

    // Animation
    const animFolder = gui.addFolder('Animation');
    animFolder.add(app.tubes.options, 'lerp', 0, 1, 0.01);
    animFolder.add(app.tubes.options, 'noise', 0, 0.2, 0.001);
  </script>
</body>
</html>
